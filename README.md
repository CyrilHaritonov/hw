# Харитонов Кирилл Александрович

Комнаты (BP_Room) генерируются посредством триггера (NewRoomTrigger), при вхождении в который спавнятся 2 блупринта комнат на заранее определенных точках (static mesh LeftRoom и RightRoom). Комната спавнится с сложностью, записанной в виде глобальной переменной в блупринте GlobalState.

Процесс изменения уровня сложности в игре (находится в функции SpawnAllEnemies в BP_Room) заключается в увеличении отрезка, на котором генерируется случайное число, на основании которого спавнятся противники. Изначально берется отрезок от Starting Difficulty в Variables Data Asset (изначально 0.3) до Starting Difficulty + Room Difficulty Delta (изначально 0.15), получаем отрезок от 0.3 до 0.45, полученное число является сложностью комнаты и записывается в переменную Difficulty, после этого Difficulty умножается на Static Enemy Spawn Coefficient (изначально 1.0), полученное значение передается в функцию Spawn Enemy, вместе с каждым дочерним компонентом компонента Enemies (они являются спавнерами). В функции SpawnEnemy спавнится актор Enemy Spawner, значение SpawnChance переданное ранее в эту функцию, передается этому актору. Далее в блупринте EnemySpawner генерируется случайное число от 0 до 1, если оно оказывается больше, чем полученный SpawnChance, то на месте спавнера спавнится актор Enemy (статический противник). Далее в следующих комнатах для такой же по сложности комнаты нижняя граница отрезка остается такой же, а верхняя опять генерируется рандомно, а для более сложной комнаты, верхняя граница предыдущего отрезка берется как нижняя для нового, а верхняя выбирается рандомно.

Спавн двигающихся противников выглядит следующим образом: в BP_Room расставлены акторы MovingEnemySpawner, в нем в EventBeginPlay берется из GlobalState теущая сложность, умножается на Moving Enemy Spawn Coefficient (1.0 изначально), потом генерируется рандомное число от 0 до 1, если оно оказывается меньше, чем полученное на предыдущем шаге число, то спавнится двигающийся противник.

В комнатах так же генерируются различные бонусы: в сложных комнатах хил, так же есть спавнеры зелий (PotionSpawner), в спавнере генерируется случайное число от 0 до 1, после чего оно по очереди сравнивается с 4 другими числами, если случайное число больше какого либо из них, то спавнится зелье, которое соответствует этому значению, значения настраиваются переменными: Spawn Chance Of Slow In Spawner, Spawn Chance Of Faze In Spawner, Spawn Chance Of Debuff In Spawner, Spawn Chance Of Random In Spawner в файле Variables. Зелье, дающее рандомный эффект, дает его в зависимости от переменных Spawn Chance Of Slow In Random, Spawn Chance Of Faze In Random, Spawn Chance Of Debuff In Random в файле Variables.

Настройка всех констант происходит в файле Variabales.

# Гайды из которых брал код
https://www.youtube.com/watch?v=HYFBmx6QRfs – Движение врагов по сплайнам

https://www.youtube.com/watch?v=iuzfmawLeZE – Постепенный урон при вхождении в триггер

https://www.youtube.com/watch?v=wde-_o5wLBI – Регдолл после смерти персонажа

https://www.youtube.com/watch?v=vO1i9Wcx4Xc – Система здоровья и UI для полоски ХП

https://www.youtube.com/watch?v=HPVUMQ3Y7DY – Создание объекта для хранения глобальных переменных
